<%= render :partial => 'spree/admin/shared/product_tabs', :locals => {:current => 'Images'} %>

<% admin_breadcrumb(plural_resource_name(Spree::Image)) %>


<% content_for :page_actions do %>
  <% if can?(:create, Spree::Image) %>
    <li><%= link_to_with_icon('plus', Spree.t(:new_image), new_admin_product_image_url(@product), :id => 'new_image_link', :class => 'button') %></li>
  <% end %>
<% end %>

<div id="images" data-hook></div>

<style>
  #upload-zone { border: 10px dashed #ccc; height: 100px; padding: 1rem 5rem; text-align: center; }
  #upload-zone.hover { border: 10px dashed #0c0; }
  .margin-bottom-one { margin-bottom: 1rem; }
  progress { width: 100%; }
</style>

<fieldset>
  <legend align="center"><%= Spree.t(:new_image) %></legend>

  <div id="upload-zone" class="margin-bottom-one">
    <%= form_for [:admin, @product, Spree::Image.new],
        :html => { :multipart => true, id: 'upload-form' } do |f| %>
      <label>
        <p>Drag images from your desktop on to the drop zone to upload to the server.</p>
        <%= f.file_field :attachment, multiple: '' %>
        <%= f.hidden_field :viewable_id, value: @product.master.id %>
      </label>
    <% end %>
  </div>


  <p id="filereader">File API &amp; FileReader API not supported</p>
  <p id="formdata">XHR2's FormData is not supported</p>
  <p id="progress">XHR2's upload progress isn't supported</p>

  <script id="progress-tmpl" type="text/x-progress-template">
    <div class="row row-xs-center margin-bottom-one">
      <div class="col-xs-10">
        <progress min="0" max="100" value="0">0</progress>
        <summary></summary>
        <error class="red hidden">Server failed to process the image</error>
      </div>
      <div class="col-xs-2"><img src="" class="img-fluid"></div>
    </div>
  </script>

  <div id="progress-zone"></div>
</fieldset>

<% no_images = @product.images.empty? && @product.variant_images.empty? %>

<table class="index sortable <%= 'hidden' if no_images %>" id="images-table" data-hook="images_table" data-sortable-link="<%= update_positions_admin_product_images_url(@product) %>">
  <colgroup>
    <col style="width: 5%">
    <col style="width: 10%">
    <% if @product.has_variants? %>
      <col style="width: 25%">
    <% end %>
    <col style="width: 45%">
    <col style="width: 15%">
  </colgroup>
  <thead>
    <tr data-hook="images_header">
      <th colspan="2"><%= Spree.t(:thumbnail) %></th>
      <% if @product.has_variants? %>
        <th><%= Spree::Variant.model_name.human %></th>
      <% end %>
      <th><%= Spree::Image.human_attribute_name(:alt) %></th>
      <th class="actions"></th>
    </tr>
  </thead>

  <tbody>
    <%= render partial: 'image_row', collection: @product.variant_images, as: :image %>
  </tbody>
</table>

<% if no_images %>
  <div class="no-objects-found">
    <%= Spree.t(:no_images_found) %>.
  </div>
<% end %>
