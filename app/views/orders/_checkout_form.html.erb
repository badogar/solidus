<% content_for :head do %>
  <%= javascript_tag "var AUTH_TOKEN = #{form_authenticity_token.inspect};" if protect_against_forgery? %>
<% end %>                 

<input type="hidden" id="hidden_bstate" name="hidden_bstate" value="<%= @order.bill_address.state_id || @order.bill_address.state_name %>" />
<input type="hidden" id="hidden_bcountry" name="hidden_bcountry" value="<%= @order.bill_address.country_id %>" />
<input type="hidden" id="hidden_sstate" name="hidden_sstate" value="<%= @order.ship_address.state_id || @order.ship_address.state_name %>" />
<input type="hidden" id="hidden_scountry" name="hidden_scountry" value="<%= @order.ship_address.country_id %>" />

<% if !current_user.addresses.empty? -%>
<div id="hidden_addresses">
  <input type="hidden" id="hidden_edit_prefix" value="/users/<%= @current_user.id %>/addresses/" />
  <% current_user.addresses.each do |address| -%>
  <div id="addr_<%= address.id %>"/>
    <%= render :partial => 'shared/address_display', :locals => { :address => address } %>
  </div>
  <% end -%>
</div>
<% end -%>

<%= error_messages_for :order %>
<div id="billing">
  <%= render :partial => 'billing', :locals => {:order_form => order_form} %>
</div>

<div id="shipping" class="checkout_disabled">
  <%= render :partial => 'shipping', :locals => {:order_form => order_form} %>
</div>
            
<div id="shipping_method" class="checkout_disabled">
  <%= render :partial => 'shipping_method', :locals => {:order_form => order_form} %>
</div>

<div id="creditcard" class="checkout_disabled">
  <%= render :partial => 'payment', :locals => {:order_form => order_form} %>
</div>

<div id="confirm_order" class="checkout_disabled">
  <%= render :partial => 'confirm_order', :locals => {:order_form => order_form} %>
</div>
